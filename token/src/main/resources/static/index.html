<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Token Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
          box-sizing: border-box;
        }
        body {
          font-family: 'Poppins', sans-serif;
          background: linear-gradient(135deg, #4b6cb7, #182848);
          display: flex;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
          margin: 0;
          color: #333;
        }
        .container {
          width: 95%;
          max-width: 420px;
          background: rgba(255, 255, 255, 0.15);
          border-radius: 20px;
          backdrop-filter: blur(15px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.25);
          overflow: hidden;
          transition: 0.4s ease;
        }
        h1 {
          text-align: center;
          color: #fff;
          margin-top: 25px;
          font-size: 28px;
          letter-spacing: 1px;
        }
        .card {
          padding: 25px 30px;
          display: none;
          animation: fadeIn 0.4s ease-in;
        }
        .card.active {
          display: block;
        }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        input, select, button {
          width: 100%;
          padding: 12px;
          margin: 8px 0;
          border-radius: 10px;
          border: 1px solid #ccc;
          font-size: 15px;
          outline: none;
        }
        input:focus, select:focus {
          border-color: #4b6cb7;
        }
        button {
          background: linear-gradient(135deg, #00b4db, #0083b0);
          color: white;
          font-weight: 600;
          border: none;
          cursor: pointer;
          transition: 0.3s ease;
        }
        button:hover {
          background: linear-gradient(135deg, #0083b0, #00b4db);
        }
        .switch-text {
          text-align: center;
          color: #fff;
          margin-top: 10px;
          font-size: 14px;
          cursor: pointer;
        }
        .switch-text:hover {
          text-decoration: underline;
        }
        .result {
          text-align: center;
          font-weight: 500;
          font-size: 14px;
        }
        .success { color: #16a34a; }
        .error { color: #dc2626; }

        /* App Section Styles */
        #appSection {
          padding: 20px 25px;
          display: none;
        }
        .shop-card {
          background: #fff;
          border-radius: 15px;
          padding: 18px;
          margin-bottom: 15px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.15);
          animation: fadeIn 0.3s ease;
        }
        .shop-card h3 {
          margin: 0 0 5px 0;
        }
        .title-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
        }
        hr {
          border: none;
          border-top: 1px solid #ccc;
          margin: 15px 0;
        }
        .logout {
          text-align: center;
          margin-top: 15px;
          color: #fff;
          font-weight: 500;
          cursor: pointer;
        }
        .logout:hover {
          text-decoration: underline;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üéüÔ∏è Token App</h1>

    <!-- SIGNUP -->
    <div id="signupCard" class="card active">
        <h2 style="text-align:center;color:white;">Create Account</h2>
        <input id="signupName" type="text" placeholder="Full Name" required>
        <input id="signupMobile" type="text" placeholder="Mobile Number" required>
        <input id="signupPassword" type="password" placeholder="Password" required>
        <button onclick="signup()">Sign Up</button>
        <p id="signupResult" class="result"></p>
        <p class="switch-text" onclick="switchCard('loginCard')">Already have an account? Login</p>
    </div>

    <!-- LOGIN -->
    <div id="loginCard" class="card">
        <h2 style="text-align:center;color:white;">Welcome Back üëã</h2>
        <input id="loginMobile" type="text" placeholder="Mobile Number" required>
        <input id="loginPassword" type="password" placeholder="Password" required>
        <button onclick="login()">Login</button>
        <p id="loginResult" class="result"></p>
        <p class="switch-text" onclick="switchCard('signupCard')">Don't have an account? Sign Up</p>
    </div>

    <!-- APP SECTION -->
    <div id="appSection">
        <h2 style="text-align:center;color:white;">üè™ Create Shop</h2>
        <select id="shopType" required>
            <option value="">Select Type</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Restaurant">Restaurant</option>
            <option value="Salon">Salon / Barber</option>
            <option value="Bank">Bank</option>
            <option value="Post Office">Post Office</option>
            <option value="Government Office">Government Office</option>
            <option value="Other">Other</option>
        </select>
        <input id="shopName" type="text" placeholder="Shop Name" required>
        <input id="shopAddress" type="text" placeholder="Address" required>
        <label style="color:white;font-size:14px;">‚è∞ Close Time</label>
        <input id="shopCloseTime" type="time" required>
        <input id="timePerCustomer" type="number" placeholder="Minutes per Customer" required>
        <button onclick="createShop()">Create Shop</button>
        <p id="createShopResult" class="result"></p>

        <hr>

        <h2 style="text-align:center;color:white;">üé´ Take Token</h2>
        <select id="filterShopType" onchange="filterByType()">
            <option value="">Select Shop Type</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Restaurant">Restaurant</option>
            <option value="Salon">Salon / Barber</option>
            <option value="Bank">Bank</option>
            <option value="Post Office">Post Office</option>
            <option value="Government Office">Government Office</option>
            <option value="Other">Other</option>
        </select>
        <select id="shopDropdown" onchange="showShopDetails()">
            <option value="">Select Shop</option>
        </select>
        <div id="shopDetails" class="shop-card" style="display:none;"></div>
        <button onclick="takeToken()">Take Token</button>
        <p id="takeResult" class="result"></p>

        <hr>

        <h2 style="text-align:center;color:white;">üéüÔ∏è My Tokens</h2>
        <button onclick="showMyTokens()">Show My Tokens</button>
        <div id="myTokensResult"></div>

        <hr>

        <h2 style="text-align:center;color:white;">üè¨ My Shops</h2>
        <button onclick="showMyShops()">Show My Shops</button>
        <div id="myShopsResult"></div>

        <p class="logout" onclick="logout()">Logout</p>
    </div>
</div>

<script>
    let authToken = "";
    let selectedShopId = "";
    let allShops = [];

    function switchCard(cardId) {
      document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
      document.getElementById(cardId).classList.add('active');
    }

    function signup() {
      const data = {
        name: document.getElementById("signupName").value,
        mobile: document.getElementById("signupMobile").value,
        password: document.getElementById("signupPassword").value
      };
      fetch("http://localhost:8080/Token/signup", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(d => {
        const msg = document.getElementById("signupResult");
        msg.innerText = d.message;
        msg.className = "result " + (d.status === "success" ? "success" : "error");
      });
    }

    function login() {
      const data = {
        mobile: document.getElementById("loginMobile").value,
        password: document.getElementById("loginPassword").value
      };
      fetch("http://localhost:8080/Token/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(d => {
        const msg = document.getElementById("loginResult");
        if (d.status === "success") {
          authToken = d.data;
          document.querySelector(".card.active").style.display = "none";
          document.getElementById("appSection").style.display = "block";
          loadShops();
        } else {
          msg.innerText = d.message;
          msg.className = "result error";
        }
      });
    }

    function logout() {
      authToken = "";
      document.getElementById("appSection").style.display = "none";
      switchCard("loginCard");
    }

    function createShop() {
      const data = {
        shopType: document.getElementById("shopType").value,
        shopName: document.getElementById("shopName").value,
        address: document.getElementById("shopAddress").value,
        closeTime: document.getElementById("shopCloseTime").value,
        timePerCustomer: parseInt(document.getElementById("timePerCustomer").value)
      };
      fetch("http://localhost:8080/Token/createShop", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + authToken
        },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(d => {
        const msg = document.getElementById("createShopResult");
        msg.innerText = d.message;
        msg.className = "result " + (d.status === "success" ? "success" : "error");
        loadShops();
      });
    }

    function loadShops() {
      fetch("http://localhost:8080/Token/getAllShops", {
        headers: {"Authorization": "Bearer " + authToken}
      })
      .then(res => res.json())
      .then(d => allShops = d.data || []);
    }

    function filterByType() {
      const type = document.getElementById("filterShopType").value;
      const dropdown = document.getElementById("shopDropdown");
      dropdown.innerHTML = '<option value="">Select Shop</option>';
      const filtered = type ? allShops.filter(s => s.shopType === type) : allShops;
      filtered.forEach(shop => {
        const opt = document.createElement("option");
        opt.value = shop.id;
        opt.text = `${shop.shopName} (${shop.shopType})`;
        dropdown.appendChild(opt);
      });
    }

    function showShopDetails() {
      selectedShopId = document.getElementById("shopDropdown").value;
      if (!selectedShopId) return;
      fetch(`http://localhost:8080/Token/getShop/${selectedShopId}`, {
        headers: {"Authorization": "Bearer " + authToken}
      })
      .then(res => res.json())
      .then(d => {
        if (d.status === "success") {
          const s = d.data;
          const div = document.getElementById("shopDetails");
          div.style.display = "block";
          div.innerHTML = `
            <div class="title-bar">
              <h3>${s.shopName}</h3>
              <span>üïí Closes at: ${s.closeTime || "N/A"}</span>
            </div>
            <p>üìç ${s.address}</p>
            <p>Type: ${s.shopType}</p>
            <p>Current Token: ${s.currentToken}</p>
            <p>Wait Time: ${s.estimatedWaitTime < 0 ? 0 : s.estimatedWaitTime} mins</p>
          `;
        }
      });
    }

    function takeToken() {
      if (!selectedShopId) return alert("Select a shop first!");
      fetch(`http://localhost:8080/Token/takeToken/${selectedShopId}`, {
        method: "POST",
        headers: {"Authorization": "Bearer " + authToken}
      })
      .then(res => res.json())
      .then(d => {
        const msg = document.getElementById("takeResult");
        msg.innerText = d.status === "success"
          ? `‚úÖ Token: ${d.data.tokenNo} | Wait: ${d.data.estimatedWaitTime} mins`
          : `‚ùå ${d.message}`;
        msg.className = "result " + (d.status === "success" ? "success" : "error");
        showShopDetails();
      });
    }

    function showMyTokens() {
      fetch("http://localhost:8080/Token/showMyTokens", {
        headers: {"Authorization": "Bearer " + authToken}
      })
      .then(res => res.json())
      .then(d => {
        const c = document.getElementById("myTokensResult");
        c.innerHTML = "";
        if (d.status === "success" && d.data.length) {
          d.data.forEach(t => {
            const div = document.createElement("div");
            div.className = "shop-card";
            div.innerHTML = `
              <h3>${t.shopName} (${t.shopType})</h3>
              <p>üìç ${t.address}</p>
              <p>üéüÔ∏è Token No: ${t.yourTokenNo}</p>
              <p>‚è≥ Wait: ${t.estimatedWaitTime} mins</p>
              <p>Status: ${t.status}</p>
            `;
            c.appendChild(div);
          });
        } else c.innerHTML = "<p>No tokens found</p>";
      });
    }

    function showMyShops() {
      fetch("http://localhost:8080/Token/myShops", {
        headers: {"Authorization": "Bearer " + authToken}
      })
      .then(res => res.json())
      .then(d => {
        const c = document.getElementById("myShopsResult");
        c.innerHTML = "";
        if (d.status === "success" && d.data.length) {
          d.data.forEach(s => {
            const div = document.createElement("div");
            div.className = "shop-card";
            div.innerHTML = `
              <h3>${s.shopName}</h3>
              <p>üìç ${s.address}</p>
              <p>üïí Closes at: ${s.closeTime || "N/A"}</p>
              <p>üéüÔ∏è Current Token: ${s.currentToken}</p>
              <p>‚è≥ ${s.timePerCustomer} mins per customer</p>
              <button onclick="completeToken(${s.id})">‚úÖ Complete Token ${s.currentToken}</button>
              <p id="result-${s.id}" class="result"></p>
            `;
            c.appendChild(div);
          });
        } else c.innerHTML = "<p>No shops found</p>";
      });
    }

    function completeToken(id) {
      fetch(`http://localhost:8080/Token/completeToken/${id}`, {
        method: "POST",
        headers: {"Authorization": "Bearer " + authToken}
      })
      .then(res => res.json())
      .then(d => {
        const msg = document.getElementById(`result-${id}`);
        msg.innerText = d.message;
        msg.className = "result " + (d.status === "success" ? "success" : "error");
        showMyShops();
        showShopDetails();
        showMyTokens();
      });
    }
</script>
</body>
</html>
